<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:NexusBridgeGui.ViewModels"
             x:Class="NexusBridgeGui.Views.Mo2SetupView"
             x:DataType="vm:Mo2SetupViewModel">

    <Grid RowDefinitions="Auto,*,Auto">
        <StackPanel Grid.Row="0" Spacing="4" Margin="0,0,0,20">
            <TextBlock Text="MO2 Setup" FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="Step 2 of 2" Foreground="Gray" FontSize="12"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1">
            <StackPanel Spacing="24">
                <!-- Warning Banner -->
                <Border Background="#3d2020" BorderBrush="#ff6b6b" BorderThickness="1" CornerRadius="4" Padding="16">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Important: Clean Install Recommended" FontWeight="Bold" Foreground="#ff6b6b" FontSize="14"/>
                        <TextBlock TextWrapping="Wrap" Foreground="#ffaaaa" FontSize="13">
                            NexusBridge is designed for clean MO2 installations. Using an existing profile with mods already installed may cause conflicts, duplicate mods, or incorrect load orders. It is strongly recommended to create a new profile for each collection installation.
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- MO2 Directory -->
                <StackPanel Spacing="8">
                    <TextBlock Text="MO2 Directory" FontWeight="SemiBold"/>
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBox Grid.Column="0"
                                 Text="{Binding Mo2Path}"
                                 Watermark="/home/user/Games/MO2"
                                 Padding="12,8"/>
                        <Button Grid.Column="1"
                                Content="Browse..."
                                Command="{Binding BrowseFolderCommand}"
                                Margin="8,0,0,0"
                                Padding="16,8"/>
                    </Grid>
                    <TextBlock Text="{Binding ValidationMessage}"
                               Foreground="Gray"
                               FontSize="12"/>

                    <!-- Override checkbox - only show when directory exists but not valid MO2 -->
                    <CheckBox IsChecked="{Binding OverrideValidation}"
                              IsVisible="{Binding !IsValidMo2Folder}"
                              Margin="0,4,0,0">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="Use this directory anyway"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="(for testing/new setups)"
                                       Foreground="Gray"
                                       FontSize="12"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </CheckBox>
                </StackPanel>

                <!-- Profile Name -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Profile Name" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ProfileName}"
                             Watermark="e.g., MyCollection"
                             Padding="12,8"/>
                    <TextBlock Text="Name for the MO2 profile where this collection will be installed"
                               Foreground="Gray" FontSize="12"/>
                </StackPanel>

                <!-- Existing Profiles -->
                <StackPanel Spacing="8" IsVisible="{Binding ExistingProfiles.Count}">
                    <TextBlock Text="Existing Profiles" FontWeight="SemiBold" Foreground="Gray"/>
                    <ItemsControl ItemsSource="{Binding ExistingProfiles}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="Gray" FontSize="12" Margin="8,2"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Back"
                    Command="{Binding GoBackCommand}"
                    Padding="24,12"/>
            <Button Content="Start Install"
                    Command="{Binding StartInstallCommand}"
                    IsEnabled="{Binding CanStartInstall}"
                    Classes="accent"
                    Padding="24,12"/>
        </StackPanel>
    </Grid>
</UserControl>
